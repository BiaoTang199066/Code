clear all
clc
%% omicron
col=[1 0 0; 0.5 0.2 0.3;  0.2 0.5 0.3; 0.2 0.8 0.3;  0.2 0.2 0.5; 0.2 0.8 0.8];
data_name={'Jilin','Beijing','Shaanxi','Shanghai','Guangdong','Hebei'};

Guangdong=[1,2,2,4,9,5,3,8,7,3,9,9,13,39,53,65,56,45,34,28,64,52,173,116,26,22,177,224,256,229,116,112,153,132,94,78,51,28,26,16,10,11,10,22,18,16,19,18,22,9,12,4,8,4,9,9,22,37,29,22,66,40,37,36,30,14,17,10,4,5,2,3,1,0,0,14,42,21,18,10,12,17,8,8,22,39,18,20,4,10,5,1,4,0,1,2,3,2,1,1]; %截止到2022/5/22清零
Beijing=[3,2,2,1,1,6,22,19,32,37,50,49,52,59,39,59,51,50,72,49,62,44,71,35,45,47,55,34,49,44,60,53,56,68,60,96,46,43,43,27,23,19,11,18,14];%截止到2022/5/31
Shanghai=[1,1,1,1,3,2,8,16,19,28,48,55,65,80,75,83,65,167,139,202,157,260,374,503,758,895,981,983,1609,2264,2676,3500,4456,5964,5637,4482,6309,8153,8935,13350,17037,19967,20899,23204,24752,26040,23069,26307,27605,22765,22591,23643,21395,19442,18368,18036,17486,22250,20517,18609,16012,12309,9764,9970,9196,7189,6804,5514,4831,4466,4088,4039,3840,3717,2858,1289,1343,1929,1541,1258,896,777,799,671,787,819,593,528,441,355,307,231,152,104,65,29,14];%截止到2022/5/31
Hebei=[1,5,7,14,10,4,11,15,32,44,73,213,198,277,216,217,269,555,407,223,192,237,312,203,146,151,114,81,83,52,68,36,111,109,109,142,163,109,87,100,44,38,31,23,17,5,0,29,62,94,78,176,117,74,51,14,11,4,2,0,4,5,28,19,11,3,2,1,1,5,10,5,2,9,4,2];%截止到2022/5/16
Jilin=[8,10,16,43,59,64,72,174,343,242,400,2156,985,4048,1832,1146,2626,2203,1475,2055,2432,2775,2565,1919,2453,1975,1792,1855,2158,2155,2210,2954,4427,3510,2398,2706,2383,2205,902,907,953,740,988,785,435,575,656,501,446,326,324,282,258,196,147,126,100,127,56,42,31,20,21,40,22,14,23,21,3,6,4,5,0,1,2,3,11,11,19,11,7,10,5,8,7,6,7,11,10,5,8,7];%截止到2022/5/31

% Shanghai=[1,1,1,1,3,2,8,16,19,28,48,55,65,80,75,83,65,167,139,202,157,260,374,503,758,895,981,983,1609,2264,2676,3500,4456,5964,5637,4482,6309,8153,8935,13350,17037,19967,20899,23204,24752,26040,23069,26307,27605,22765,22591,23643,21395,19442,18368,18036,17486,22250,20517,18609,16012,12309,9764,9970,9196,7189,6804,5514,4831,4466,4088,4039,3840,3717,2858,1289,1343,1929,1541,1258,896,777,799,671,787]; %上海数据
% Jilin=[8,10,16,43,59,64,72,174,343,242,400,2156,985,4048,1832,1146,2626,2203,1475,2055,2432,2775,2565,1919,2453,1975,1792,1855,2158,2155,2210,2954,4427,3510,2398,2706,2383,2205,902,907,953,740,988,785,435,575,656,501,446,326,324,282,258,196,147,126,100,127,56,42,31,20,21,40,22,14,23,21,3,6,4,5];% 数据
Shaanxi=[2,0,5,17,21,18,30,43,60,53,28,26,33,11,15,14,7,3,3,3,3,6,0,3]; %陕西
% Guangdong=[1,2,2,4,9,5,3,8,7,3,9,9,13,39,53,65,56,45,34,28,64,52,173,116,26,22,177,224,256,229,116,112,153,132,94,78,51,28,26,16,10,11,10,22,18,16,19,18,22,9,12,4,8,4,9,9,22,37,29,22,66,40,37,36,30,14,17,10,4,5,2,3,1];  %广东
% Guangdong=[1,2,2,4,9,5,3,8,7,3,9,9,13,39,53,65,56,45,34,28,64,52,173,116,26,22,177,224,256,229,116,112,153,132,94,78,51,28,26,16,10,11,10,22,18,16,19,18,22,9,12,4,8,4,9,9,22,37,29,22,66,40,37,36,30,14,17,10,4,5,2,3,1,0,0,14,42,21,18,10,12,17,8,8,22,39,18,20,4,10,5,1,4,0,1,2,3,2,1,1]; %截止到2022/5/22清零
% Hebei=[1,5,7,14,10,4,11,15,32,44,73,213,198,277,216,217,269,555,407,223,192,237,312,203,146,151,114,81,83,52,68,36,111,109,109,142,163,109,87,100,44,38,31,23,17,5]; %河北
% Beijing=[3 2 2 1 1 6 22 19 32 34 50 49 52 59 39 59 51 50 72 49 62 44 71 35 45 47 55 34 49 44 60 53 56 68 60 96 46 43 43 27 23]';

a=[0.45, 0.34, 0.4, 0.39, 0.19, 0.36];
b=[1.548, 0.188, 0.619, -0.84, 0.309, 0.322];
c=[14, 13, 8, 46, 27, 18 ];%13
a2=[ -0.19, -0.16, -0.22,-0.12,  -0.32, -0.26];
b2=[ 15.369, 9.816, 5.812,16.77,  23.705, 14.472];
c2=[ 40, 35, 9, 60, 36]
delay=round(b./a)+1  %滞后时间
tau1=round(b./a)+1 %滞后时间
tau2=[14, 11, 9, 45, 8, 14 ]-1;
tau3=[24, 25, 0, 13, 0 ,0]
Tc=(1-a./a2).*(tau1+tau2)+tau3-1
tau4=ceil(Tc)-tau1-tau2-tau3-1
figure
x=1:15
for i=1:6
    data=eval(char(data_name(i))); 
    plot(delay(i)+1:delay(i)+length(data),log(data),'-.','color',col(i,:),'LineWidth',1.5)
    hold on
    plot(x,a(i)*x,'color',col(i,:),'LineWidth',1.5)
    box
end
plot(x,mean(a)*x,'k','LineWidth',1.5)
legend(data_name)
figure
for i=1:3
    y1=0;
    subplot(2,3,i)
    R(i)=a(i)/gamma+1
   y1(1)=1;j=2
    for t=1:tau1(i)+tau2(i)
        y1(j)=y1(j-1)*exp(a(i));
        j=j+1;
    end
    hold on
    box
    data=eval(char(data_name(i))); 

    y0=y1(tau1(i)+tau2(i)+1);%j=tau1(i)+tau2(i)+1;
    for t=tau1(i)+tau2(i)+1:tau1(i)+tau2(i)+tau3(i)
         y1(j)=y0;
         j=j+1;
    end
    %% 
    for t=tau1(i)+tau2(i)+tau3(i)+1:Tc(i)
        y1(j)=y0*exp(a2(i));
        y0=y1(end);
        j=j+1;
    end
    x2=1:ceil(Tc(i));
        h(i)= plot(x2,y1(1:length(x2)),'-','color',col(i,:),'LineWidth',1.5)
        plot(tau1(i)+1:length(data)+tau1(i),data,'o','color',col(i,:))
        title(data_name(i))
        xlabel('t')
        ylabel('Daily reported cases')
end
sum(data)

plot(5,1:110,'-')


%% shanghai
a=[0.39, 0.24, 0.18, 0, -0.12];
b=[-0.84, 0.32, 2.1, 0, 16.77];
c=[15, 34, 45, 59];
t=1;
    delay=0;%b(1)/a(1)
    x=1:ceil(-b(5)/a(5));
    for t=1:c(1)
        y(t)=a(1)*x(t)+b(1);
    end
  
    y0=y(end);
    for t=c(1)+1:ceil(c(2)+delay)%
        y(t)=a(2)*x(t)+b(2);
         y0=y(end);
    end
    for t=ceil(c(2)+delay)+1:ceil(c(3)+delay)%
        y(t)=a(3)*x(t)+b(3);
         y0=y(end);
    end
    %%  
    for t=ceil(c(3)+delay)+1:ceil(c(4)+delay)%
         y(t)=y0;
         y0=y(end);
    end
    %%  
    for t=ceil(c(4)+delay)+1:ceil(-b(5)/a(5));%
        y(t)=a(5)*x(t)+b(5);
        y0=y(end);
        j=j+1;
    end
      subplot(234)
        plot(x,exp(y),'-','color',col(1,:),'LineWidth',1.5)
        hold on    
        plot(Shanghai,'o','color',col(2,:))
        title('Shanghai')
        xlabel('t')
        ylabel('Daily reported cases')

%% guangdong

a=[0.19, -0.24, 0, -0.32];
b=[0.309, 12.601, 0, 23.705];
c=[24, 42, 59]; 
t=1;
    %%  
    delay=round(b(1)/a(1))+1
    x=1:ceil(-b(4)/a(4));
    y=0;
    for t=1:c(1)+delay
        y(t)=a(1)*x(t)+b(1);
    end
    %%  
    for t=c(1)+1+delay:c(2)+delay
        y(t)=a(2)*x(t)+b(2);
    end
   %%  
    y0=y(end);
    for t=c(2)+delay:ceil(c(3)+delay)
         y(t)=y0;
         y0=y(end);
    end
    %%  
    for t=ceil(c(3)+delay)+1:ceil(-b(4)/a(4))
        y(t)=a(4)*x(t)+b(4);
        y0=y(end);
        j=j+1;
    end
      subplot(235)
        plot(x,exp(y),'-','color',col(1,:),'LineWidth',1.5)
        hold on    
        plot(1+delay:length(Guangdong)+delay,Guangdong,'o','color',col(2,:))
        title('Guangdong')
        xlabel('t')
        ylabel('Daily reported cases')


%% 河北

a=[0.36, -0.12, 0, -0.26];
b=[0.322, 7.963, 0, 14.472];
c=[15, 30, 36]; 
t=1;
    %%  
    delay=round(b(1)/a(1))+1
    x=1:ceil(-b(4)/a(4));
    y=0;
    for t=1:c(1)+delay
        y(t)=a(1)*x(t)+b(1);
    end
    %%  
    for t=c(1)+delay+1:c(2)+delay
        y(t)=a(2)*x(t)+b(2);
    end
   %%  
    y0=y(end);
    for t=c(2)+delay:ceil(c(3)+delay)
         y(t)=y0;
         y0=y(end);
    end
    %%  
    for t=ceil(c(3)+delay)+1:ceil(-b(4)/a(4))
        y(t)=a(4)*x(t)+b(4);
        y0=y(end);
        j=j+1;
    end
      subplot(236)
        plot(x,exp(y),'-','color',col(1,:),'LineWidth',1.5)
        hold on    
         plot(delay+1:length(Hebei)+delay,Hebei,'o','color',col(2,:))
        title('Heibei')
        xlabel('t')
        ylabel('Daily reported cases')























